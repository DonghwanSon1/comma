<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¼¼ë§ˆ í•„ë¦„</title>
    <style>
        /* ì „ì²´ ë°°ê²½ê³¼ ë ˆì´ì•„ì›ƒ */
        body {
            background-color: #fff;
            font-family: Arial, sans-serif;
            color: #333;
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
        }

        .header .logo {
            font-size: 24px;
            color: #4d7c2a;
            font-weight: bold;
        }

        .header nav a {
            margin: 0 10px;
            text-decoration: none;
            color: #333;
        }

        .basket-button {
            background-color: #4d7c2a;
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
        }

        /* ê²€ìƒ‰ ì„¹ì…˜ */
        .search-section {
            display: flex;
            align-items: center;
            margin: 20px 0;
        }

        .search-section input {
            border: 1px solid #ccc;
            padding: 5px 10px;
            flex: 1;
            margin: 0 10px;
        }

        .search-section .filter select {
            border: 1px solid #ccc;
            padding: 5px;
        }

        .search-icon {
            cursor: pointer;
        }

        /* ì œí’ˆ ë¦¬ìŠ¤íŠ¸ */
        .product-list {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .product-card {
            border: 1px solid #eaeaea;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            width: 300px;
            cursor: pointer;
        }

        .product-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .product-info {
            padding: 10px;
        }

        .product-info .code {
            color: #888;
            font-size: 12px;
        }

        .price {
            color: #4d7c2a;
            font-weight: bold;
            margin: 5px 0;
        }

        .desc {
            font-size: 12px;
            color: #666;
        }

        /* ëª¨ë‹¬ ì°½ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            max-width: 600px;
            width: 100%;
            text-align: center;
        }

        .modal img {
            width: 100%;
            max-width: 400px;
            height: auto;
            margin-bottom: 20px;
        }

        .modal .price {
            font-size: 20px;
            color: #4d7c2a;
            margin-bottom: 10px;
        }

        .modal .close-btn {
            background-color: #4d7c2a;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .modal .close-btn:hover {
            background-color: #3c6634;
        }
    </style>
</head>
<body>
<div class="container">
    <!-- í—¤ë” -->
    <header class="header">
        <div class="logo">ê¼¼ë§ˆ í•„ë¦„</div>
    </header>

    <!-- ê²€ìƒ‰ ë° í•„í„° -->
    <section class="search-section">
        <div class="filter">
            <select id="brandSelect">
                <option value="">ì „ì²´</option> <!-- ì˜µì…˜ì— value ê°’ì„ ì¶”ê°€ -->
            </select>
        </div>
        <input type="text" id="searchInput" placeholder="ê²€ìƒ‰í•  ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." />
        <span class="search-icon" id="searchIcon">ğŸ”</span>
    </section>

    <!-- ì œí’ˆ ë¦¬ìŠ¤íŠ¸ -->
    <section class="product-list" id="productList">
        <!-- ì´ˆê¸° ì œí’ˆ ë¦¬ìŠ¤íŠ¸ -->
    </section>
</div>

<!-- ëª¨ë‹¬ ì°½ -->
<div id="modal" class="modal">
    <div class="modal-content">
        <img id="modalImage" src="" alt="ì œí’ˆ ì´ë¯¸ì§€">
        <p id="modalUrl" class="url"></p>
        <p id="modalPrice" class="price"></p>
        <button class="close-btn" onclick="closeModal()">ë‹«ê¸°</button>
    </div>
</div>

<script>
    let isLoading = false; // ìš”ì²­ ì¤‘ì¸ì§€ í™•ì¸í•˜ëŠ” ë³€ìˆ˜
    let currentPage = 0;   // í˜„ì¬ í˜ì´ì§€
    let totalPages = 1;    // ì „ì²´ í˜ì´ì§€ ìˆ˜ (ê¸°ë³¸ê°’ì€ 1)
    const pageSize = 10;   // í•œ í˜ì´ì§€ ë‹¹ í‘œì‹œí•  í•­ëª© ìˆ˜

    // ë¸Œëœë“œë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
    async function fetchBrands() {
        try {
            const response = await fetch('http://localhost:8080/comma-film/brand');
            const data = await response.json();

            if (data.status === 200) {
                const selectElement = document.getElementById('brandSelect');
                data.data.forEach(brand => {
                    const option = document.createElement('option');
                    option.value = brand.sn;
                    option.textContent = brand.name;
                    selectElement.appendChild(option);
                });
            } else {
                console.error('API í˜¸ì¶œ ì‹¤íŒ¨:', data.message);
            }
        } catch (error) {
            console.error('API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
        }
    }

    // í•„í„°ì™€ ê²€ìƒ‰ì–´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì œí’ˆì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
    async function fetchFilms() {
        if (isLoading || currentPage >= totalPages) return; // ìš”ì²­ ì¤‘ì´ê±°ë‚˜, ë§ˆì§€ë§‰ í˜ì´ì§€ì— ë„ë‹¬í•˜ë©´ ì¤‘ì§€
        isLoading = true; // ìš”ì²­ ì‹œì‘

        const brandSn = document.getElementById('brandSelect').value; // ì„ íƒëœ ë¸Œëœë“œ ID
        const searchQuery = document.getElementById('searchInput').value.trim(); // ê²€ìƒ‰ì–´

        try {
            const url = `http://localhost:8080/comma-film/film?brandSn=${brandSn}&code=${searchQuery}&page=${currentPage}&size=${pageSize}`;
            const response = await fetch(url);
            const data = await response.json();

            if (data.status === 200 && data.data.content.length > 0) {
                const productListElement = document.getElementById('productList');

                // ìƒˆë¡œìš´ ì œí’ˆë“¤ì„ ì¶”ê°€
                data.data.content.forEach(film => {
                    const productCard = document.createElement('div');
                    productCard.classList.add('product-card');

                    const productImage = document.createElement('img');
                    productImage.src = film.filmImageUrl;
                    productImage.alt = film.filmName;
                    productImage.classList.add('product-image');
                    productImage.onclick = () => openModal(film); // ì´ë¯¸ì§€ í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸°

                    const productInfo = document.createElement('div');
                    productInfo.classList.add('product-info');

                    const brandInfo = document.createElement('strong');
                    brandInfo.innerHTML = `${film.brandName} <span class="code">${film.filmCode}</span>`;

                    const price = document.createElement('p');
                    price.classList.add('price');
                    price.textContent = film.filmConsumerPrice > 0 ? `${film.filmConsumerPrice} ì›` : 'ê°€ê²© ë¯¸ì •';

                    const description = document.createElement('p');
                    description.classList.add('desc');
                    description.textContent = film.filmColor;

                    // HTML êµ¬ì¡°ì— ì¶”ê°€
                    productInfo.appendChild(brandInfo);
                    productInfo.appendChild(price);
                    productInfo.appendChild(description);

                    productCard.appendChild(productImage);
                    productCard.appendChild(productInfo);

                    productListElement.appendChild(productCard);
                });

                // ì „ì²´ í˜ì´ì§€ ìˆ˜ì™€ í˜„ì¬ í˜ì´ì§€ ê°±ì‹ 
                totalPages = data.data.totalPages;
                currentPage++; // í˜ì´ì§€ ì¦ê°€
            } else {
                console.log('No films found');
                document.getElementById('productList').innerHTML = 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.';
            }
        } catch (error) {
            console.error('API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
        } finally {
            isLoading = false; // ìš”ì²­ ì™„ë£Œ í›„ isLoadingì„ falseë¡œ ì„¤ì •
        }
    }

    // ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ì—ì„œ í˜ì´ì§€ë¥¼ ë³€ê²½í•˜ê³  ìš”ì²­ í˜¸ì¶œ
    window.addEventListener('scroll', () => {
        if (window.innerHeight + window.scrollY >= document.documentElement.scrollHeight - 100) {
            fetchFilms(); // ìŠ¤í¬ë¡¤ì´ ë°”ë‹¥ì— ë‹¿ìœ¼ë©´ í˜¸ì¶œ
        }
    });

    // í…ìŠ¤íŠ¸ ë°•ìŠ¤ì—ì„œ ì—”í„°ë¥¼ ì…ë ¥í–ˆì„ ë•Œ ë‹ë³´ê¸° í´ë¦­í•œ ê²ƒì²˜ëŸ¼ ë™ì‘í•˜ê²Œ í•˜ëŠ” ì½”ë“œ
    document.getElementById('searchInput').addEventListener('keydown', function(event) {
        if (event.key === 'Enter') {
            // ì—”í„° í‚¤ê°€ ëˆŒë ¸ì„ ë•Œ ë‹ë³´ê¸° í´ë¦­ ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
            document.getElementById('searchIcon').click();
        }
    });

    // ë‹ë³´ê¸° í´ë¦­ ì‹œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
    document.getElementById('searchIcon').addEventListener('click', () => {
        currentPage = 0; // ê²€ìƒ‰ì„ ìƒˆë¡œ ì‹œì‘í•˜ë©´ í˜ì´ì§€ë¥¼ 0ìœ¼ë¡œ ë¦¬ì…‹
        totalPages = 1;  // ì „ì²´ í˜ì´ì§€ ìˆ˜ ì´ˆê¸°í™”
        document.getElementById('productList').innerHTML = ''; // ê¸°ì¡´ ì œí’ˆ ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”
        fetchFilms(); // ê²€ìƒ‰ì–´ì— ë§ì¶° ì²« ë²ˆì§¸ í˜ì´ì§€ ë°ì´í„° ìš”ì²­
    });

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë¸Œëœë“œ ê°€ì ¸ì˜¤ê¸°
    window.onload = fetchBrands;

    // ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜
    function openModal(film) {
        const modal = document.getElementById('modal');
        const modalImage = document.getElementById('modalImage');
        const modalPrice = document.getElementById('modalPrice');
        const modalUrl = document.getElementById('modalUrl'); // ë¸Œëœë“œ ë§í¬ë¥¼ ë‹´ì„ p íƒœê·¸ ê°€ì ¸ì˜¤ê¸°

        // ëª¨ë‹¬ì— ì´ë¯¸ì§€ì™€ ê°€ê²© ì¶”ê°€
        modalImage.src = film.filmImageUrl;
        modalPrice.textContent = film.filmMyPrice > 0 ? `${film.filmMyPrice} ì›` : 'ê°€ê²© ë¯¸ì •';

        // ëª¨ë‹¬ì— ë¸Œëœë“œ ë§í¬ ì¶”ê°€
        if (film.brandUrl) {
            modalUrl.innerHTML = `<a href="${film.brandUrl}" target="_blank">${film.brandName} í™ˆí˜ì´ì§€</a>`;
        } else {
            modalUrl.textContent = ''; // ë¸Œëœë“œ ë§í¬ê°€ ì—†ë‹¤ë©´ ë¹ˆ í…ìŠ¤íŠ¸
        }

        modal.style.display = 'flex'; // ëª¨ë‹¬ í‘œì‹œ
    }



    // ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
    function closeModal() {
        const modal = document.getElementById('modal');
        modal.style.display = 'none'; // ëª¨ë‹¬ ë‹«ê¸°
    }
</script>
</body>
</html>
